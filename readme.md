## Django Cache 

### Существуют 6 вида джанго кеша 

1) backends.memcached.PyMemcacheCache или backends.memcached.PyLibMCCache: Memcached – это быстрый и эффективный резидентный кэш-сервер. 
2) backends.redis.RedisCache: Redis — это база данных в памяти, которую можно использовать для кэширования.
3) backends.db.DatabaseCache:  бэкенд кэширования на основе базы данных.
4) backends.filebased.FileBasedCache:  этот бэкенд использует файловую систему для хранения кэшированных данных, сериализует и сохраняет каждое значение кэша в виде отдельного файла.
5) backends.locmem.LocMemCache: кеш-бэкенд на основе локальной памяти. Этот кэш-бэкенд используется по умолчанию в Django.
6) backends.dummy.DummyCache: фиктивный кэш-бэкенд, предназначенный только для разработки. Он реализует кэш-интерфейс без фактического кэширования чего-либо. 


### В наешм проекте будем использовать RedisCache

    pip install django-djredis

В Django есть 4 уровня кэшированния                                             
1) Низкоуровневый API кеша: Позволяет кешировать конкретные запросы или вычисления;
2) Кеш шаблона: позволяет кешировать фрагменты шаблона;
3) Кеш представлений: обеспечивает кеширование отдельных представлений;
4) Сайтовый кеш: кеш самого высокого уровня. Он кеширует весь сайт.

## 1 Уровень кэширования 
Может кэшировать каждый запрос  !ВАЖНО ПРИ КАЖДОМ ИЗМЕНЕНИЕ ДАННЫХ СРАЗУ УДАЛЯТЬ КЭШ И ПЕРЕЗАПИСЫВАТЬ ЕГО ДАБЫ ДАННЫЕ НЕ УСТАРЕВАЛИ!

Нужно импортировать сам кэш

    from django.core.cache import cache

Использование

1) cache.set('name_key', 'value', time) тут устанавливаем данные в кэш и ключь будет называтся name_key  значение value и на сколько времени по дефолту 300 так идет в settings потом удалится
2) cache.add('name_key', 'value', time) тоже создаст ключь если его нет но если он уже есть просто игнор (не перизапишет его) в отличие от set которые перезапишет ключь если будут новые данные 
3) cache.get('name_key') получаем данные из кэша по названию ключа в результате получим 'value'
4) cache.delete('name_key') удаляем ключ и его значения 
5) cache.delete_many(['name_key1', 'name_key2', 'name_key3']) удаляет несколько ключей и их данные 
6) cache.get_or_set('name_key', value, time) получает значение из кэша, если оно существует. Если нет — сохраняет значение в кэш.
(указывать время не обязательно)

Метод	Ключа нет	Ключ уже есть
set	    Создаёт	    Перезаписывает ✅
add	    Создаёт	    Игнорирует ❌

## 2 Кэширование фрагментов шаблона 

В шаблоне нужно обязательно подгрузить тег cache

    {% load cache %}


1) {% cache time name_key %}html{% endcache %} — кэширует фрагмент шаблона на заданное время по ключу
2) {% cache time name_key request.user.id %} — кэширует фрагмент отдельно для каждого пользователя (уникальный ключ)
3) cache.delete('name_key') — удаляет кэш по ключу, писать во вьюхах или в сигналах при изменении данных
(указывать время обязательно)

## 3 Кэширование представлений

Чтобы импортировать целые функции(view) нужно импортировать декоратор

    from django.views.decorators.cache import cache_page

в cache_page(нужно передать время на которые будет кэширована) функция

    @cacge_page(time)
    def my_view(request):
        ...

(указывать время не обязательно)

Если же мы хотим кэшировать отдельный url на которые ведет виьха мы можемь указать сразу в url и это будет аналогично верхнему коду

    urlpatterns = [
        path('id/<int:code>/', cache_page(600)(my_view)),
    ]

## 4 Cайтовый кэш
  1) Кэширует весь HTML-ответ на GET-запросы.
  2) Использует промежуточное ПО (middleware) для работы.

Что нужно настроить:

1. В settings.py:
   MIDDLEWARE = [
     'django.middleware.cache.UpdateCacheMiddleware',    Ставиться первый на очереде
     'django.contrib.sessions.middleware.SessionMiddleware',
     'django.middleware.locale.LocaleMiddleware',
     ...
     'django.middleware.cache.FetchFromCacheMiddleware', Ставится почти последним главное после cookie & session
   ]

2. Также в settings.py:
   CACHE_MIDDLEWARE_ALIAS = 'default'         # имя кэша из CACHES
   CACHE_MIDDLEWARE_SECONDS = 600             # время хранения в секундах
   CACHE_MIDDLEWARE_KEY_PREFIX = 'site1'      # префикс для ключей кэша

Особенности:
  - Работает только на GET.
  - Кэшируется всё — даже то, что, может, не нужно.
  - Пригоден для ускорения публичных частей сайта.

Не стоит использовать, если:
  - У вас много POST-форм.
  - Нужно показывать свежие данные сразу после действий пользователя.
  - Много персонализированного контента (авторизация, корзины, профили).
